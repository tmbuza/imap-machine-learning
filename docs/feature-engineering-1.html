<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>5 Feature Engineering | IMAP: Integrated Microbiome Analysis Pipelines</title>
<meta name="author" content="Teresia Mrema-Buza">
<meta name="description" content="Feature engineering is a crucial step in the machine learning pipeline where raw data is transformed into a format that enhances the performance of predictive models. This process involves...">
<meta name="generator" content="bookdown 0.39 with bs4_book()">
<meta property="og:title" content="5 Feature Engineering | IMAP: Integrated Microbiome Analysis Pipelines">
<meta property="og:type" content="book">
<meta property="og:url" content="https://tmbuza.github.io/imap-machine-learning/feature-engineering-1.html">
<meta property="og:image" content="https://tmbuza.github.io/imap-machine-learning/images/planning.png">
<meta property="og:description" content="Feature engineering is a crucial step in the machine learning pipeline where raw data is transformed into a format that enhances the performance of predictive models. This process involves...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="5 Feature Engineering | IMAP: Integrated Microbiome Analysis Pipelines">
<meta name="twitter:description" content="Feature engineering is a crucial step in the machine learning pipeline where raw data is transformed into a format that enhances the performance of predictive models. This process involves...">
<meta name="twitter:image" content="https://tmbuza.github.io/imap-machine-learning/images/planning.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><link href="libs/Sen-0.4.9/font.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=DM%20Mono&amp;display=swap" rel="stylesheet">
<link href="libs/Bitter-0.4.9/font.css" rel="stylesheet">
<script src="libs/bs3compat-0.7.0/transition.js"></script><script src="libs/bs3compat-0.7.0/tabs.js"></script><script src="libs/bs3compat-0.7.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script><script src="libs/d3-3.3.8/d3.min.js"></script><script src="libs/dagre-0.4.0/dagre-d3.min.js"></script><link href="libs/mermaid-0.3.0/dist/mermaid.css" rel="stylesheet">
<script src="libs/mermaid-0.3.0/dist/mermaid.slim.min.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/chromatography-0.1/chromatography.js"></script><script src="libs/DiagrammeR-binding-1.0.11/DiagrammeR.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="End-to-End Practical User Guides Using Integrated Approaches"><big>IMAP:</big> Integrated Microbiome Analysis Pipelines</a>:
        <small class="text-muted">End-to-End Practical User Guides Using Integrated Approaches</small>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">IMAP-Machine Learning: Predictive Modeling Using Microbiome Data</a></li>
<li class="book-part">ML COMPONENTS</li>
<li><a class="" href="key-components-of-microbiome-machine-learning.html"><span class="header-section-number">1</span> Key Components of Microbiome Machine Learning</a></li>
<li class="book-part">ML FRAMEWORKS</li>
<li><a class="" href="ml-framework_R.html"><span class="header-section-number">2</span> Machine Learning Framework in R: From Data Acquisition to Model Deployment</a></li>
<li class="book-part">ML PROTOTYPES</li>
<li><a class="" href="machine-learning-prototypes-streamlining-microbiome-model-development-and-deployment.html"><span class="header-section-number">3</span> Machine Learning Prototypes: Streamlining Microbiome Model Development and Deployment</a></li>
<li class="book-part">MODEL DEVELOPMENT</li>
<li><a class="" href="exploratory-data-analysis-eda.html"><span class="header-section-number">4</span> Exploratory Data Analysis (EDA)</a></li>
<li><a class="active" href="feature-engineering-1.html"><span class="header-section-number">5</span> Feature Engineering</a></li>
<li class="book-part">MODEL TRAINING</li>
<li><a class="" href="data-splitting.html"><span class="header-section-number">6</span> Data Splitting</a></li>
<li><a class="" href="model-fitting.html"><span class="header-section-number">7</span> Model Fitting</a></li>
<li><a class="" href="hyperparameter-tuning.html"><span class="header-section-number">8</span> Hyperparameter Tuning</a></li>
<li><a class="" href="model-performance-metrics.html"><span class="header-section-number">9</span> Model Performance Metrics</a></li>
<li class="book-part">PERFORMANCE METRICS</li>
<li><a class="" href="specificity-and-sensitivity-function.html"><span class="header-section-number">10</span> Specificity and Sensitivity function</a></li>
<li class="book-part">MODEL DEPLOYMENT</li>
<li><a class="" href="shiny-applications.html"><span class="header-section-number">11</span> Shiny Applications</a></li>
<li class="book-part">APPENDIX</li>
<li><a class="" href="modeling-ideas.html"><span class="header-section-number">A</span> Modeling Ideas</a></li>
<li><a class="" href="using-ml-helper-function.html"><span class="header-section-number">B</span> Using ML helper function</a></li>
<li><a class="" href="imap-github-repos.html"><span class="header-section-number">C</span> IMAP GitHub Repos</a></li>
<li><a class="" href="session-information.html"><span class="header-section-number">D</span> Session Information</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/tmbuza/imap-machine-learning">View book source <i class="fas fa-air-freshener"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="feature-engineering-1" class="section level1" number="5">
<h1>
<span class="header-section-number">5</span> Feature Engineering<a class="anchor" aria-label="anchor" href="#feature-engineering-1"><i class="fas fa-link"></i></a>
</h1>
<p>Feature engineering is a crucial step in the machine learning pipeline where raw data is transformed into a format that enhances the performance of predictive models. This process involves creating new features, selecting relevant features, and transforming existing features to improve the model’s ability to capture patterns and make accurate predictions.</p>
<p>Some common techniques used in feature engineering include:</p>
<ul>
<li>
<strong>Feature Creation:</strong> Generating new features from existing ones, such as extracting information from text, dates, or categorical variables, or creating interaction terms between variables.</li>
<li>
<strong>Feature Selection:</strong> Identifying the most relevant features that contribute the most to the predictive power of the model while reducing dimensionality and computational complexity.</li>
<li>
<strong>Feature Transformation:</strong> Applying transformations to features to make the data more suitable for modeling, such as scaling numeric features, encoding categorical variables, or handling missing values.</li>
</ul>
<p>By performing effective feature engineering, we can improve the performance, interpretability, and robustness of machine learning models, ultimately leading to better predictions and insights from the data.</p>
<div id="processing-data-for-machine-learning" class="section level2" number="5.1">
<h2>
<span class="header-section-number">5.1</span> Processing data for machine learning<a class="anchor" aria-label="anchor" href="#processing-data-for-machine-learning"><i class="fas fa-link"></i></a>
</h2>
<p>This section outlines the preprocessing steps involved in preparing data subsets tailored for machine learning analysis. The code segments transform raw data into structured formats suitable for predictive modeling. Specifically, the subsets created encompass various combinations of taxonomic or metabolic features alongside binary labels representing selected features. Each subset undergoes specific preprocessing steps, including data selection, transformation, and encoding, to ensure compatibility with machine learning algorithms.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Subset for machine learning analysis: Taxonomic genus features with disease states</span></span>
<span></span>
<span><span class="va">ml_genus_dsestate</span> <span class="op">&lt;-</span> <span class="va">composite</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">sample_id</span>, <span class="va">taxonomy</span>, enttype <span class="op">=</span> <span class="va">Enterotype</span>, <span class="va">rel_abund</span>, dsestate <span class="op">=</span> <span class="va">Disease_State</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from<span class="op">=</span><span class="va">taxonomy</span>, values_from <span class="op">=</span> <span class="va">rel_abund</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">sample_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>enttype <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">enttype</span> <span class="op">==</span> <span class="st">"Enterotype_1"</span>, <span class="st">"0"</span>, <span class="st">"1"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>dsestate <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">dsestate</span> <span class="op">==</span> <span class="st">"pHTN"</span> <span class="op">|</span> <span class="va">dsestate</span> <span class="op">==</span> <span class="st">"HTN"</span> , <span class="st">"0"</span>, <span class="st">"1"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">enttype</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">dsestate</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Subset for machine learning analysis: Taxonomic genus features with enterotypes</span></span>
<span><span class="va">ml_genus_enttype</span> <span class="op">&lt;-</span> <span class="va">composite</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">sample_id</span>, <span class="va">taxonomy</span>, enttype <span class="op">=</span> <span class="va">Enterotype</span>, <span class="va">rel_abund</span>, dsestate <span class="op">=</span> <span class="va">Disease_State</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from<span class="op">=</span><span class="va">taxonomy</span>, values_from <span class="op">=</span> <span class="va">rel_abund</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">sample_id</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>enttype <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">enttype</span> <span class="op">==</span> <span class="st">"Enterotype_1"</span>, <span class="st">"0"</span>, <span class="st">"1"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>dsestate <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">dsestate</span> <span class="op">==</span> <span class="st">"pHTN"</span> <span class="op">|</span> <span class="va">dsestate</span> <span class="op">==</span> <span class="st">"HTN"</span> , <span class="st">"0"</span>, <span class="st">"1"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">dsestate</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">enttype</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Dietswap dataset: Subset for machine learning analysis: Taxonomic genus features with nationality and body mass index group</span></span>
<span></span>
<span><span class="co"># Nationality feature</span></span>
<span><span class="va">ml_genus_nationality</span> <span class="op">&lt;-</span> <span class="va">ps_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">sample_id</span>, <span class="va">taxon</span>, <span class="va">nationality</span>, <span class="va">rel_abund</span>, <span class="va">bmi</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    taxon <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace_all</a></span><span class="op">(</span><span class="va">taxon</span>, <span class="st">"\\*"</span>, <span class="st">""</span><span class="op">)</span>,</span>
<span>    nationality <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">nationality</span> <span class="op">==</span> <span class="st">"AAM"</span>, <span class="st">"0"</span>, <span class="st">"1"</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"0"</span>, <span class="st">"1"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    bmi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">bmi</span> <span class="op">==</span> <span class="st">"overweight"</span> <span class="op">|</span> <span class="va">bmi</span> <span class="op">==</span> <span class="st">"obese"</span>, <span class="st">"0"</span>, <span class="st">"1"</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"0"</span>, <span class="st">"1"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">sample_id</span>, <span class="va">taxon</span>, <span class="va">nationality</span>, <span class="va">bmi</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>rel_abund <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">rel_abund</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">taxon</span>, values_from <span class="op">=</span> <span class="va">rel_abund</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">nationality</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  <span class="co"># Remove rows with NA in the 'nationality' column</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">sample_id</span>, <span class="va">bmi</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"rel_abund"</span><span class="op">)</span>, <span class="va">as.numeric</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Body mass index feature</span></span>
<span><span class="va">ml_genus_bmi</span> <span class="op">&lt;-</span> <span class="va">ps_df</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">sample_id</span>, <span class="va">taxon</span>, <span class="va">nationality</span>, <span class="va">rel_abund</span>, <span class="va">bmi</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span></span>
<span>    taxon <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace_all</a></span><span class="op">(</span><span class="va">taxon</span>, <span class="st">"\\*"</span>, <span class="st">""</span><span class="op">)</span>,</span>
<span>    nationality <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">nationality</span> <span class="op">==</span> <span class="st">"AAM"</span>, <span class="st">"0"</span>, <span class="st">"1"</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"0"</span>, <span class="st">"1"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    bmi <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">bmi</span> <span class="op">==</span> <span class="st">"overweight"</span> <span class="op">|</span> <span class="va">bmi</span> <span class="op">==</span> <span class="st">"obese"</span>, <span class="st">"0"</span>, <span class="st">"1"</span><span class="op">)</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"0"</span>, <span class="st">"1"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">sample_id</span>, <span class="va">taxon</span>, <span class="va">nationality</span>, <span class="va">bmi</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>rel_abund <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">rel_abund</span><span class="op">)</span>, .groups <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">taxon</span>, values_from <span class="op">=</span> <span class="va">rel_abund</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">bmi</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  <span class="co"># Remove rows with NA in the 'bmi' column</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">sample_id</span>, <span class="va">nationality</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html">starts_with</a></span><span class="op">(</span><span class="st">"rel_abund"</span><span class="op">)</span>, <span class="va">as.numeric</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Save the processed data objects into an RDA file for downstream analysis</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/save.html">save</a></span><span class="op">(</span><span class="va">composite</span>,</span>
<span>     <span class="va">metabo_composite</span>,</span>
<span>     <span class="va">ml_genus_dsestate</span>,</span>
<span>     <span class="va">ps_df</span>,</span>
<span>     <span class="va">ml_genus_enttype</span>, </span>
<span>     <span class="va">ml_genus_nationality</span>, </span>
<span>     <span class="va">ml_genus_bmi</span>, </span>
<span>     file <span class="op">=</span> <span class="st">"data/ml_n_composite_object.rda"</span><span class="op">)</span></span></code></pre></div>
<div class="alerticon">
<p>
<strong>Note for users:</strong>
</p>
<blockquote>
<p>
If you encounter issues during data processing where pivot_wider()
returns values as &lt;list&gt;, it may be due to multiple values for the
same combination of identifiers (e.g., sample ID and feature). In such
cases, consider aggregating the values using group_by() and summarise()
before pivoting.
</p>
</blockquote>
<p>
Example:
</p>
<p>
ps_df %&gt;% select(sample_id, taxon, nationality, rel_abund, bmi)
%&gt;% mutate(taxon = str_replace_all(taxon, “*“,”“)) %&gt;%
group_by(sample_id, taxon, nationality, bmi) %&gt;% summarise(rel_abund
= mean(rel_abund), .groups =”drop”) %&gt;% pivot_wider(names_from =
taxon, values_from = rel_abund) %&gt;% mutate(nationality =
if_else(nationality == “AAM”, “0”, “1”)) %&gt;% mutate(bmi = if_else(bmi
== “overweight” | bmi == “obese” , “0”, “1”)) %&gt;%
select(-c(sample_id, bmi))
</p>
<blockquote>
<p>
This ensures that the rel_abund values are properly aggregated before
pivoting.
</p>
</blockquote>
</div>
</div>
<div id="feature-selection" class="section level2" number="5.2">
<h2>
<span class="header-section-number">5.2</span> Feature Selection<a class="anchor" aria-label="anchor" href="#feature-selection"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>
<strong>Objective</strong>: Perform feature selection to identify relevant microbial taxa or functional pathways associated with the binary outcome of interest, such as disease status or treatment response.</li>
<li>
<strong>Techniques</strong>: Utilize methods like Lasso regularization, Recursive Feature Elimination (RFE), and Boruta algorithm to automatically select important features and penalize less informative ones, enhancing model interpretability and performance.</li>
</ul>
</div>
<div id="feature-selection-techniques" class="section level2" number="5.3">
<h2>
<span class="header-section-number">5.3</span> Feature Selection Techniques<a class="anchor" aria-label="anchor" href="#feature-selection-techniques"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>
<strong>Variance Threshold</strong>: Identify features with low variance, which may be less informative for the model, and remove them from consideration.</li>
<li>
<strong>Univariate Selection</strong>: Evaluate the relationship between each feature and the target variable independently, selecting the most relevant features based on statistical tests.</li>
<li>
<strong>Recursive Feature Elimination (RFE)</strong>: Iteratively remove the least significant features from the model until the optimal subset of features is achieved, based on model performance metrics.</li>
<li>
<strong>Principal Component Analysis (PCA)</strong>: Transform the original features into a lower-dimensional space while retaining most of the variance, effectively reducing the dimensionality of the data and identifying important patterns.</li>
<li>
<strong>Feature Importance</strong>: Assess the importance of each feature based on its contribution to model performance, using techniques like Random Forest feature importance or permutation importance.</li>
</ul>
</div>
<div id="variance-threshold" class="section level2" number="5.4">
<h2>
<span class="header-section-number">5.4</span> Variance threshold<a class="anchor" aria-label="anchor" href="#variance-threshold"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="feature-engineering-1.html#cb5-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb5-2"><a href="feature-engineering-1.html#cb5-2" tabindex="-1"></a></span>
<span id="cb5-3"><a href="feature-engineering-1.html#cb5-3" tabindex="-1"></a><span class="co"># Example dataset (replace with your own data)</span></span>
<span id="cb5-4"><a href="feature-engineering-1.html#cb5-4" tabindex="-1"></a>data <span class="ot">&lt;-</span> ml_genus_nationality</span>
<span id="cb5-5"><a href="feature-engineering-1.html#cb5-5" tabindex="-1"></a><span class="co"># data &lt;- ml_genus_bmi</span></span>
<span id="cb5-6"><a href="feature-engineering-1.html#cb5-6" tabindex="-1"></a><span class="co"># data &lt;- ml_genus_enttype</span></span>
<span id="cb5-7"><a href="feature-engineering-1.html#cb5-7" tabindex="-1"></a><span class="co"># data &lt;- ml_genus_dsestate</span></span>
<span id="cb5-8"><a href="feature-engineering-1.html#cb5-8" tabindex="-1"></a></span>
<span id="cb5-9"><a href="feature-engineering-1.html#cb5-9" tabindex="-1"></a><span class="co"># Calculate variance for each feature</span></span>
<span id="cb5-10"><a href="feature-engineering-1.html#cb5-10" tabindex="-1"></a>variances <span class="ot">&lt;-</span> <span class="fu">apply</span>(data[, <span class="sc">-</span><span class="dv">1</span>], <span class="dv">2</span>, var)  <span class="co"># Exclude the first column (nationality)</span></span>
<span id="cb5-11"><a href="feature-engineering-1.html#cb5-11" tabindex="-1"></a></span>
<span id="cb5-12"><a href="feature-engineering-1.html#cb5-12" tabindex="-1"></a><span class="co"># Set the threshold for variance</span></span>
<span id="cb5-13"><a href="feature-engineering-1.html#cb5-13" tabindex="-1"></a>threshold <span class="ot">&lt;-</span> <span class="fl">0.0001</span>  <span class="co"># Adjust as needed</span></span>
<span id="cb5-14"><a href="feature-engineering-1.html#cb5-14" tabindex="-1"></a></span>
<span id="cb5-15"><a href="feature-engineering-1.html#cb5-15" tabindex="-1"></a><span class="co"># Identify features with variance above the threshold</span></span>
<span id="cb5-16"><a href="feature-engineering-1.html#cb5-16" tabindex="-1"></a>selected_features <span class="ot">&lt;-</span> <span class="fu">names</span>(variances[variances <span class="sc">&gt;</span> threshold])</span>
<span id="cb5-17"><a href="feature-engineering-1.html#cb5-17" tabindex="-1"></a></span>
<span id="cb5-18"><a href="feature-engineering-1.html#cb5-18" tabindex="-1"></a><span class="co"># Remove NA values from selected_features</span></span>
<span id="cb5-19"><a href="feature-engineering-1.html#cb5-19" tabindex="-1"></a>selected_features <span class="ot">&lt;-</span> selected_features[<span class="sc">!</span><span class="fu">is.na</span>(selected_features)]</span>
<span id="cb5-20"><a href="feature-engineering-1.html#cb5-20" tabindex="-1"></a></span>
<span id="cb5-21"><a href="feature-engineering-1.html#cb5-21" tabindex="-1"></a><span class="co"># Add the first column (nationality) to the selected features</span></span>
<span id="cb5-22"><a href="feature-engineering-1.html#cb5-22" tabindex="-1"></a>selected_features <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"nationality"</span>, selected_features)</span>
<span id="cb5-23"><a href="feature-engineering-1.html#cb5-23" tabindex="-1"></a></span>
<span id="cb5-24"><a href="feature-engineering-1.html#cb5-24" tabindex="-1"></a><span class="co"># Filter dataset to include selected features</span></span>
<span id="cb5-25"><a href="feature-engineering-1.html#cb5-25" tabindex="-1"></a>filtered_data <span class="ot">&lt;-</span> data[, <span class="fu">colnames</span>(data) <span class="sc">%in%</span> selected_features]</span>
<span id="cb5-26"><a href="feature-engineering-1.html#cb5-26" tabindex="-1"></a></span>
<span id="cb5-27"><a href="feature-engineering-1.html#cb5-27" tabindex="-1"></a><span class="co"># Display filtered dataset</span></span>
<span id="cb5-28"><a href="feature-engineering-1.html#cb5-28" tabindex="-1"></a><span class="fu">head</span>(filtered_data[, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])</span>
<span id="cb5-29"><a href="feature-engineering-1.html#cb5-29" tabindex="-1"></a><span class="co"># A tibble: 6 × 5</span></span>
<span id="cb5-30"><a href="feature-engineering-1.html#cb5-30" tabindex="-1"></a>  nationality Akkermansia Allistipes <span class="st">`</span><span class="at">Bacteroides fragilis</span><span class="st">`</span> <span class="st">`</span><span class="at">Bacteroides ovatus</span><span class="st">`</span></span>
<span id="cb5-31"><a href="feature-engineering-1.html#cb5-31" tabindex="-1"></a>  <span class="sc">&lt;</span>fct<span class="sc">&gt;</span>             <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>      <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>                  <span class="er">&lt;</span>dbl<span class="sc">&gt;</span>                <span class="er">&lt;</span>dbl<span class="sc">&gt;</span></span>
<span id="cb5-32"><a href="feature-engineering-1.html#cb5-32" tabindex="-1"></a><span class="dv">1</span> <span class="dv">0</span>              <span class="fl">0.00213</span>     <span class="fl">0.0397</span>                 <span class="fl">0.0524</span>              <span class="fl">0.0505</span>  </span>
<span id="cb5-33"><a href="feature-engineering-1.html#cb5-33" tabindex="-1"></a><span class="dv">2</span> <span class="dv">1</span>              <span class="fl">0.00724</span>     <span class="fl">0.00180</span>                <span class="fl">0.00151</span>             <span class="fl">0.000637</span></span>
<span id="cb5-34"><a href="feature-engineering-1.html#cb5-34" tabindex="-1"></a><span class="dv">3</span> <span class="dv">1</span>              <span class="fl">0.136</span>       <span class="fl">0.00897</span>                <span class="fl">0.0729</span>              <span class="fl">0.00518</span> </span>
<span id="cb5-35"><a href="feature-engineering-1.html#cb5-35" tabindex="-1"></a><span class="dv">4</span> <span class="dv">1</span>              <span class="fl">0.00101</span>     <span class="fl">0.00299</span>                <span class="fl">0.00139</span>             <span class="fl">0.00112</span> </span>
<span id="cb5-36"><a href="feature-engineering-1.html#cb5-36" tabindex="-1"></a><span class="dv">5</span> <span class="dv">1</span>              <span class="fl">0.00490</span>     <span class="fl">0.00713</span>                <span class="fl">0.00312</span>             <span class="fl">0.00279</span> </span>
<span id="cb5-37"><a href="feature-engineering-1.html#cb5-37" tabindex="-1"></a><span class="dv">6</span> <span class="dv">1</span>              <span class="fl">0.000706</span>    <span class="fl">0.00116</span>                <span class="fl">0.00116</span>             <span class="fl">0.000899</span></span>
<span id="cb5-38"><a href="feature-engineering-1.html#cb5-38" tabindex="-1"></a></span>
<span id="cb5-39"><a href="feature-engineering-1.html#cb5-39" tabindex="-1"></a></span>
<span id="cb5-40"><a href="feature-engineering-1.html#cb5-40" tabindex="-1"></a></span>
<span id="cb5-41"><a href="feature-engineering-1.html#cb5-41" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb5-42"><a href="feature-engineering-1.html#cb5-42" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb5-43"><a href="feature-engineering-1.html#cb5-43" tabindex="-1"></a><span class="fu">library</span>(mikropml)</span>
<span id="cb5-44"><a href="feature-engineering-1.html#cb5-44" tabindex="-1"></a></span>
<span id="cb5-45"><a href="feature-engineering-1.html#cb5-45" tabindex="-1"></a>training_data <span class="ot">&lt;-</span> filtered_data <span class="sc">%&gt;%</span></span>
<span id="cb5-46"><a href="feature-engineering-1.html#cb5-46" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">target =</span> nationality) <span class="sc">%&gt;%</span> </span>
<span id="cb5-47"><a href="feature-engineering-1.html#cb5-47" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">target =</span> <span class="fu">recode_factor</span>(target, <span class="st">"0"</span> <span class="ot">=</span> <span class="st">"AAM"</span>, <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"AFR"</span>))</span></code></pre></div>
<blockquote>
<p>Note: NA values must be removed from the selected_features vector before filtering the dataset to avoid errors.</p>
</blockquote>
</div>
</div>



  <div class="chapter-nav">
<div class="prev"><a href="exploratory-data-analysis-eda.html"><span class="header-section-number">4</span> Exploratory Data Analysis (EDA)</a></div>
<div class="next"><a href="data-splitting.html"><span class="header-section-number">6</span> Data Splitting</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#feature-engineering-1"><span class="header-section-number">5</span> Feature Engineering</a></li>
<li><a class="nav-link" href="#processing-data-for-machine-learning"><span class="header-section-number">5.1</span> Processing data for machine learning</a></li>
<li><a class="nav-link" href="#feature-selection"><span class="header-section-number">5.2</span> Feature Selection</a></li>
<li><a class="nav-link" href="#feature-selection-techniques"><span class="header-section-number">5.3</span> Feature Selection Techniques</a></li>
<li><a class="nav-link" href="#variance-threshold"><span class="header-section-number">5.4</span> Variance threshold</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/tmbuza/imap-machine-learning/blob/gh-pages/01b_ml_realdata_prototypes.Rmd">View source <i class="fas fa-air-freshener"></i></a></li>
          <li><a id="book-edit" href="https://github.com/tmbuza/imap-machine-learning/edit/gh-pages/01b_ml_realdata_prototypes.Rmd">Edit this page <i class="fas fa-air-freshener"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container">
    <div class="row">
      <div class="col-12 col-md-6 mt-3">
        <p><strong><u><a class="text-light" href="https://microbiome.complexdatainsights.com"><big>IMAP:</big> Integrated Microbiome Analysis Pipelines</a></u></strong>: End-to-End Practical User Guides Using Integrated Approaches</p>
<br><p>Authored by Teresia Mrema-Buza, Last updated: <b>2024-04-24</b>.</p>
<br>
</div>
      <div class="col-12 col-md-6 mt-3">
        <p>Note: This practical guide was created using the <a class="text-light" href="https://bookdown.org/yihui/bookdown/">bookdown</a> R package, styled with the modern bs4_book format.</p>
      </div>

    </div>
  </div>
</footer>
</body>
</html>
