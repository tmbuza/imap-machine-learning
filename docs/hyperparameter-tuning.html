<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>8 Hyperparameter Tuning | IMAP: Integrated Microbiome Analysis Pipelines</title>
<meta name="author" content="Teresia Mrema-Buza">
<meta name="description" content="In this stage, our objective is to refine the parameters utilized during model fitting to maximize performance. We concentrate on optimizing the model’s effectiveness by fine-tuning various...">
<meta name="generator" content="bookdown 0.39 with bs4_book()">
<meta property="og:title" content="8 Hyperparameter Tuning | IMAP: Integrated Microbiome Analysis Pipelines">
<meta property="og:type" content="book">
<meta property="og:url" content="https://tmbuza.github.io/imap-machine-learning/hyperparameter-tuning.html">
<meta property="og:image" content="https://tmbuza.github.io/imap-machine-learning/images/planning.png">
<meta property="og:description" content="In this stage, our objective is to refine the parameters utilized during model fitting to maximize performance. We concentrate on optimizing the model’s effectiveness by fine-tuning various...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="8 Hyperparameter Tuning | IMAP: Integrated Microbiome Analysis Pipelines">
<meta name="twitter:description" content="In this stage, our objective is to refine the parameters utilized during model fitting to maximize performance. We concentrate on optimizing the model’s effectiveness by fine-tuning various...">
<meta name="twitter:image" content="https://tmbuza.github.io/imap-machine-learning/images/planning.png">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><link href="libs/Sen-0.4.9/font.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=DM%20Mono&amp;display=swap" rel="stylesheet">
<link href="libs/Bitter-0.4.9/font.css" rel="stylesheet">
<script src="libs/bs3compat-0.7.0/transition.js"></script><script src="libs/bs3compat-0.7.0/tabs.js"></script><script src="libs/bs3compat-0.7.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script><script src="libs/d3-3.3.8/d3.min.js"></script><script src="libs/dagre-0.4.0/dagre-d3.min.js"></script><link href="libs/mermaid-0.3.0/dist/mermaid.css" rel="stylesheet">
<script src="libs/mermaid-0.3.0/dist/mermaid.slim.min.js"></script><link href="libs/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="libs/chromatography-0.1/chromatography.js"></script><script src="libs/DiagrammeR-binding-1.0.11/DiagrammeR.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="End-to-End Practical User Guides Using Integrated Approaches"><big>IMAP:</big> Integrated Microbiome Analysis Pipelines</a>:
        <small class="text-muted">End-to-End Practical User Guides Using Integrated Approaches</small>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">IMAP-Part 10: Predictive Modeling Using Microbiome Data</a></li>
<li class="book-part">ML COMPONENTS</li>
<li><a class="" href="key-components-of-microbiome-machine-learning.html"><span class="header-section-number">1</span> Key Components of Microbiome Machine Learning</a></li>
<li class="book-part">ML FRAMEWORKS</li>
<li><a class="" href="ml-framework_R.html"><span class="header-section-number">2</span> Machine Learning Framework in R: From Data Acquisition to Model Deployment</a></li>
<li class="book-part">ML PROTOTYPES</li>
<li><a class="" href="machine-learning-prototypes-streamlining-microbiome-model-development-and-deployment.html"><span class="header-section-number">3</span> Machine Learning Prototypes: Streamlining Microbiome Model Development and Deployment</a></li>
<li class="book-part">MODEL DEVELOPMENT</li>
<li><a class="" href="exploratory-data-analysis-eda.html"><span class="header-section-number">4</span> Exploratory Data Analysis (EDA)</a></li>
<li><a class="" href="feature-engineering-1.html"><span class="header-section-number">5</span> Feature Engineering</a></li>
<li class="book-part">MODEL TRAINING</li>
<li><a class="" href="data-splitting.html"><span class="header-section-number">6</span> Data Splitting</a></li>
<li><a class="" href="model-fitting.html"><span class="header-section-number">7</span> Model Fitting</a></li>
<li><a class="active" href="hyperparameter-tuning.html"><span class="header-section-number">8</span> Hyperparameter Tuning</a></li>
<li><a class="" href="model-performance-metrics.html"><span class="header-section-number">9</span> Model Performance Metrics</a></li>
<li class="book-part">PERFORMANCE METRICS</li>
<li><a class="" href="specificity-and-sensitivity-function.html"><span class="header-section-number">10</span> Specificity and Sensitivity function</a></li>
<li class="book-part">MODEL DEPLOYMENT</li>
<li><a class="" href="shiny-applications.html"><span class="header-section-number">11</span> Shiny Applications</a></li>
<li class="book-part">APPENDIX</li>
<li><a class="" href="modeling-ideas.html"><span class="header-section-number">A</span> Modeling Ideas</a></li>
<li><a class="" href="using-ml-helper-function.html"><span class="header-section-number">B</span> Using ML helper function</a></li>
<li><a class="" href="imap-github-repos.html"><span class="header-section-number">C</span> IMAP GitHub Repos</a></li>
<li><a class="" href="session-information.html"><span class="header-section-number">D</span> Session Information</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/tmbuza/imap-machine-learning">View book source <i class="fas fa-air-freshener"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="hyperparameter-tuning" class="section level1" number="8">
<h1>
<span class="header-section-number">8</span> Hyperparameter Tuning<a class="anchor" aria-label="anchor" href="#hyperparameter-tuning"><i class="fas fa-link"></i></a>
</h1>
<p>In this stage, our objective is to refine the parameters utilized during model fitting to maximize performance. We concentrate on optimizing the model’s effectiveness by fine-tuning various hyperparameters. These parameters, such as regularization strength or tree depth, are manually adjusted to enhance the model’s accuracy. Through experimentation with different values, our goal is to pinpoint the optimal combination that maximizes performance on validation data. This pivotal step ensures that the model not only excels on training data but also generalizes effectively to new, unseen data.</p>
<p><strong>Parameter tuning for a RLR Model</strong></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set seed for reproducibility</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">110912</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load necessary libraries</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/topepo/caret/">caret</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define the tuning grid</span></span>
<span><span class="va">tuneGrid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html">expand.grid</a></span><span class="op">(</span></span>
<span>  cost <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0.001</span>, <span class="fl">1</span>, length.out <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>,  <span class="co"># Define a sequence of cost values</span></span>
<span>  loss <span class="op">=</span> <span class="st">"L2_primal"</span>,  <span class="co"># Specify the loss function</span></span>
<span>  epsilon <span class="op">=</span> <span class="fl">0.01</span>  <span class="co"># Set the epsilon value</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set up cross-validation method</span></span>
<span><span class="va">ctrl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/trainControl.html">trainControl</a></span><span class="op">(</span></span>
<span>  method <span class="op">=</span> <span class="st">"adaptive_cv"</span>,  <span class="co"># Use adaptive cross-validation</span></span>
<span>  verboseIter <span class="op">=</span> <span class="cn">FALSE</span>  <span class="co"># Print progress during each iteration</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Perform hyperparameter tuning</span></span>
<span><span class="va">mod_regLogistic_cv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/caret/man/train.html">train</a></span><span class="op">(</span></span>
<span>  <span class="va">target</span> <span class="op">~</span> <span class="va">.</span>,  <span class="co"># Define the formula for the model</span></span>
<span>  data <span class="op">=</span> <span class="va">training_data</span>,  <span class="co"># Specify the training dataset</span></span>
<span>  method <span class="op">=</span> <span class="st">"regLogistic"</span>,  <span class="co"># Choose the regularized logistic regression method</span></span>
<span>  tuneLength <span class="op">=</span> <span class="fl">12</span>,  <span class="co"># Set the number of tuning parameter combinations to try</span></span>
<span>  trControl <span class="op">=</span> <span class="va">ctrl</span>,  <span class="co"># Specify the cross-validation method</span></span>
<span>  tuneGrid <span class="op">=</span> <span class="va">tuneGrid</span>  <span class="co"># Use the defined tuning grid</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visualize the model performance</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">mod_regLogistic_cv</span><span class="op">$</span><span class="va">results</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">cost</span>, y <span class="op">=</span> <span class="va">Accuracy</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># Add a line plot</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># Add points for each data point</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Accuracy vs. Cost for Regularized Logistic Regression Model (Adaptive CV)"</span>,  <span class="co"># Set the plot title</span></span>
<span>    x <span class="op">=</span> <span class="st">"Cost"</span>,  <span class="co"># Label the x-axis</span></span>
<span>    y <span class="op">=</span> <span class="st">"Accuracy"</span>  <span class="co"># Label the y-axis</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span>  <span class="co"># Apply a black and white theme</span></span></code></pre></div>
<div class="inline-figure"><img src="figures/unnamed-chunk-24-1.png" width="672"></div>
<div id="confusion-matrix" class="section level2" number="8.1">
<h2>
<span class="header-section-number">8.1</span> Confusion Matrix<a class="anchor" aria-label="anchor" href="#confusion-matrix"><i class="fas fa-link"></i></a>
</h2>
<p>A Confusion Matrix summarizes the performance of a classification model by tabulating the true positive, true negative, false positive, and false negative predictions.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="hyperparameter-tuning.html#cb25-1" tabindex="-1"></a><span class="co"># Load necessary libraries</span></span>
<span id="cb25-2"><a href="hyperparameter-tuning.html#cb25-2" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb25-3"><a href="hyperparameter-tuning.html#cb25-3" tabindex="-1"></a><span class="co"># Predict using the trained model</span></span>
<span id="cb25-4"><a href="hyperparameter-tuning.html#cb25-4" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod_regLogistic_cv, <span class="at">newdata =</span> test_data)</span>
<span id="cb25-5"><a href="hyperparameter-tuning.html#cb25-5" tabindex="-1"></a></span>
<span id="cb25-6"><a href="hyperparameter-tuning.html#cb25-6" tabindex="-1"></a><span class="co"># Compute confusion matrix</span></span>
<span id="cb25-7"><a href="hyperparameter-tuning.html#cb25-7" tabindex="-1"></a>confusion_matrix <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">confusionMatrix</span>(predictions, test_data<span class="sc">$</span>target)</span>
<span id="cb25-8"><a href="hyperparameter-tuning.html#cb25-8" tabindex="-1"></a></span>
<span id="cb25-9"><a href="hyperparameter-tuning.html#cb25-9" tabindex="-1"></a><span class="fu">print</span>(confusion_matrix)</span>
<span id="cb25-10"><a href="hyperparameter-tuning.html#cb25-10" tabindex="-1"></a>Confusion Matrix and Statistics</span>
<span id="cb25-11"><a href="hyperparameter-tuning.html#cb25-11" tabindex="-1"></a></span>
<span id="cb25-12"><a href="hyperparameter-tuning.html#cb25-12" tabindex="-1"></a>          Reference</span>
<span id="cb25-13"><a href="hyperparameter-tuning.html#cb25-13" tabindex="-1"></a>Prediction AAM AFR</span>
<span id="cb25-14"><a href="hyperparameter-tuning.html#cb25-14" tabindex="-1"></a>       AAM  <span class="dv">19</span>   <span class="dv">3</span></span>
<span id="cb25-15"><a href="hyperparameter-tuning.html#cb25-15" tabindex="-1"></a>       AFR   <span class="dv">5</span>  <span class="dv">16</span></span>
<span id="cb25-16"><a href="hyperparameter-tuning.html#cb25-16" tabindex="-1"></a>                                         </span>
<span id="cb25-17"><a href="hyperparameter-tuning.html#cb25-17" tabindex="-1"></a>               Accuracy <span class="sc">:</span> <span class="fl">0.814</span>          </span>
<span id="cb25-18"><a href="hyperparameter-tuning.html#cb25-18" tabindex="-1"></a>                 <span class="dv">95</span>% CI <span class="sc">:</span> (<span class="fl">0.666</span>, <span class="fl">0.9161</span>)</span>
<span id="cb25-19"><a href="hyperparameter-tuning.html#cb25-19" tabindex="-1"></a>    No Information Rate <span class="sc">:</span> <span class="fl">0.5581</span>         </span>
<span id="cb25-20"><a href="hyperparameter-tuning.html#cb25-20" tabindex="-1"></a>    P<span class="sc">-</span>Value [Acc <span class="sc">&gt;</span> NIR] <span class="sc">:</span> <span class="fl">0.000393</span>       </span>
<span id="cb25-21"><a href="hyperparameter-tuning.html#cb25-21" tabindex="-1"></a>                                         </span>
<span id="cb25-22"><a href="hyperparameter-tuning.html#cb25-22" tabindex="-1"></a>                  Kappa <span class="sc">:</span> <span class="fl">0.6269</span>         </span>
<span id="cb25-23"><a href="hyperparameter-tuning.html#cb25-23" tabindex="-1"></a>                                         </span>
<span id="cb25-24"><a href="hyperparameter-tuning.html#cb25-24" tabindex="-1"></a> Mcnemar<span class="st">'s Test P-Value : 0.723674       </span></span>
<span id="cb25-25"><a href="hyperparameter-tuning.html#cb25-25" tabindex="-1"></a><span class="st">                                         </span></span>
<span id="cb25-26"><a href="hyperparameter-tuning.html#cb25-26" tabindex="-1"></a><span class="st">            Sensitivity : 0.7917         </span></span>
<span id="cb25-27"><a href="hyperparameter-tuning.html#cb25-27" tabindex="-1"></a><span class="st">            Specificity : 0.8421         </span></span>
<span id="cb25-28"><a href="hyperparameter-tuning.html#cb25-28" tabindex="-1"></a><span class="st">         Pos Pred Value : 0.8636         </span></span>
<span id="cb25-29"><a href="hyperparameter-tuning.html#cb25-29" tabindex="-1"></a><span class="st">         Neg Pred Value : 0.7619         </span></span>
<span id="cb25-30"><a href="hyperparameter-tuning.html#cb25-30" tabindex="-1"></a><span class="st">             Prevalence : 0.5581         </span></span>
<span id="cb25-31"><a href="hyperparameter-tuning.html#cb25-31" tabindex="-1"></a><span class="st">         Detection Rate : 0.4419         </span></span>
<span id="cb25-32"><a href="hyperparameter-tuning.html#cb25-32" tabindex="-1"></a><span class="st">   Detection Prevalence : 0.5116         </span></span>
<span id="cb25-33"><a href="hyperparameter-tuning.html#cb25-33" tabindex="-1"></a><span class="st">      Balanced Accuracy : 0.8169         </span></span>
<span id="cb25-34"><a href="hyperparameter-tuning.html#cb25-34" tabindex="-1"></a><span class="st">                                         </span></span>
<span id="cb25-35"><a href="hyperparameter-tuning.html#cb25-35" tabindex="-1"></a><span class="st">       '</span>Positive<span class="st">' Class : AAM            </span></span>
<span id="cb25-36"><a href="hyperparameter-tuning.html#cb25-36" tabindex="-1"></a><span class="st">                                         </span></span></code></pre></div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="model-fitting.html"><span class="header-section-number">7</span> Model Fitting</a></div>
<div class="next"><a href="model-performance-metrics.html"><span class="header-section-number">9</span> Model Performance Metrics</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#hyperparameter-tuning"><span class="header-section-number">8</span> Hyperparameter Tuning</a></li>
<li><a class="nav-link" href="#confusion-matrix"><span class="header-section-number">8.1</span> Confusion Matrix</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/tmbuza/imap-machine-learning/blob/gh-pages/01b_ml_realdata_prototypes.Rmd">View source <i class="fas fa-air-freshener"></i></a></li>
          <li><a id="book-edit" href="https://github.com/tmbuza/imap-machine-learning/edit/gh-pages/01b_ml_realdata_prototypes.Rmd">Edit this page <i class="fas fa-air-freshener"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container">
    <div class="row">
      <div class="col-12 col-md-6 mt-3">
        <p><strong><u><a class="text-light" href="https://microbiome.complexdatainsights.com"><big>IMAP:</big> Integrated Microbiome Analysis Pipelines</a></u></strong>: End-to-End Practical User Guides Using Integrated Approaches</p>
<br><p>Authored by Teresia Mrema-Buza, Last updated: <b>2024-04-24</b>.</p>
<br>
</div>
      <div class="col-12 col-md-6 mt-3">
        <p>Note: This practical guide was created using the <a class="text-light" href="https://bookdown.org/yihui/bookdown/">bookdown</a> R package, styled with the modern bs4_book format.</p>
      </div>

    </div>
  </div>
</footer>
</body>
</html>
